{# This file is part of INGInious. See the LICENSE and the COPYRIGHTS files for #}
{# more information about the licensing of this file. #}

{% set at = course.get_task_dispenser().get_accessibility(taskid, user_manager.session_username()) %}

{% if short %}
    {{_("Accessibility")}} :
    <span class="accessibility accessibility-never" {% if not at.is_never_accessible() %} style="display: none;" {% endif %}>{{_("Never")}}</span>
    <span class="accessibility accessibility-always" {% if not at.is_always_accessible() %} style="display: none;" {% endif %}>{{_("Always")}}</span>
    <span class="accessibility accessibility-custom" {% if at.is_always_accessible() or at.is_never_accessible() %} style="display: none;" {% endif %}>
        {{ _("Custom, from: {} to: {}").format('<span class="accessibility-custom-start">' + str(at.get_std_start_date()) + '</span>', '<span class="accessibility-custom-end">' + at.get_std_end_date() + '</span>') | safe}}
        (<span class="accessibility-custom-soft-end">{{ at.get_std_soft_end_date() }}</span>)
    </span>
{% else %}
<div class="mt-3">{{_("Accessibility")}}</div>
<div class="form-group row {%if not taskid %} grouped-actions-{% endif %}accessibility">

    <div class="col-md-12">
        <label>
            <input class="accessibility" type="radio" value="false" name="accessibility_{{taskid}}" {%if taskid %} id="{{taskid}}" {% endif %}
                {{ 'checked="checked"'|safe if at.is_never_accessible() }} />
            {{_("Never")}}
        </label>
    </div>
    <div class="col-md-12">
        <label>
            <input class="accessibility" type="radio" value="true" name="accessibility_{{taskid}}" {%if taskid %} id="{{taskid}}" {% endif %}
                {{ 'checked="checked"'|safe if at.is_always_accessible() }} />
            {{_("Always")}}
        </label>
    </div>
    <div class="col-md-12 row">
        <div class="col-xs-12 col-lg-3">
            <label class="control-label">
                <input class="accessibility" type="radio" value="custom" name="accessibility_{{taskid}}" {%if taskid %} id="{{taskid}}" {% endif %}
                    {{'checked="checked"'|safe if not at.is_never_accessible() and not at.is_always_accessible() }} />
                {%set text = _("Custom, from: {} to: {}").split("{}") %}
                {{ text[0] }}</label>
        </div>
        <div class="col-xs-offset-1 col-lg-offset-0 col-xs-11 col-lg-4">
            <div class='input-group date' id='accessibility_start_picker_{{taskid}}' data-target-input="nearest">
                <input data-target='#accessibility_start_picker_{{taskid}}' id="accessibility_start_{{taskid}}" data-date-format="YYYY-MM-DD HH:mm:ss" value="{{at.get_std_start_date()}}" placeholder="2014-06-29 10:00" type='text' class="form-control datetimepicker-input" />
                <div class="input-group-append" data-target="#accessibility_start_picker_{{taskid}}" data-toggle="datetimepicker">
                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                </div>
            </div>
        </div>
        <div class="col-xs-offset-1 col-lg-offset-0 col-xs-11 col-lg-1"><label class="control-label">{{text[1]}}</label></div>
        <div class="col-xs-offset-1 col-lg-offset-0 col-xs-11 col-lg-4">
            <div class='input-group date' id='accessibility_end_picker_{{taskid}}' data-target-input="nearest">
                <input data-target='#accessibility_end_picker_{{taskid}}' id="accessibility_end_{{taskid}}" data-date-format="YYYY-MM-DD HH:mm:ss" value="{{at.get_std_end_date()}}" placeholder="2014-06-29 10:00" type='text' class="form-control datetimepicker-input" />
                <div class="input-group-append" data-target="#accessibility_end_picker_{{taskid}}" data-toggle="datetimepicker">
                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-12 row">
        <!-- Padding -->
        <div class="col-xs-12 col-lg-3"></div>
        <div class="col-xs-offset-1 col-lg-offset-0 col-xs-11 col-lg-4"></div>
        <!-- End of padding -->
        <div class="col-xs-offset-1 col-lg-offset-0 col-xs-11 col-lg-1"><label class="control-label" data-toggle="tooltip" data-placement="top" title="{{ _('Students can still submit after this date') }}">{{ _("Soft Deadline") }} <sup>?</sup></label></div>
        <div class="col-xs-offset-1 col-lg-offset-0 col-xs-11 col-lg-4">
            <div class="form-group">
                <div class='input-group date' id='accessibility_soft_end_picker_{{taskid}}' data-target-input="nearest">
                        <input data-target='#accessibility_soft_end_picker_{{taskid}}' id="accessibility_soft_end_{{taskid}}" data-date-format="YYYY-MM-DD HH:mm:ss" value="{{at.get_std_soft_end_date()}}" placeholder="2014-06-29 10:00" type='text' class="form-control datetimepicker-input" />
                        <div class="input-group-append" data-target="#accessibility_soft_end_picker_{{taskid}}" data-toggle="datetimepicker">
                                <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                        </div>

                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(function() {
            $('#accessibility_start_picker_{{taskid}}').datetimepicker({locale: '{{user_manager.session_language()}}', sideBySide: true, format:'YYYY-MM-DD HH:mm:ss'});
            $('#accessibility_end_picker_{{taskid}}').datetimepicker({locale: '{{user_manager.session_language()}}', sideBySide: true, format:'YYYY-MM-DD HH:mm:ss'});
            $('#accessibility_soft_end_picker_{{taskid}}').datetimepicker({locale: '{{user_manager.session_language()}}', sideBySide: true, format:'YYYY-MM-DD HH:mm:ss'});
        });
    </script>
</div>

{% if taskid %}
<script>
    $("#edit_{{taskid}} .accessibility input").change(function () {
        let action = $(this).attr("name");
        if(action == "accessibility_{{taskid}}") {
            $("#task_{{taskid}} .accessibility").hide();
            if($(this).val() == "true")
                $("#task_{{taskid}} .accessibility-always").show();
            else if($(this).val() == "false")
                $("#task_{{taskid}} .accessibility-never").show();
            else
                $("#task_{{taskid}} .accessibility-custom").show();
        }
        else {
            let id = $(this).attr("id");
            if (id == "accessibility_start_{{taskid}}")
                $("#task_{{taskid}} .accessibility-custom-start").text($(this).val());
            else if(id == "accessibility_end_{{taskid}}")
                $("#task_{{taskid}} .accessibility-custom-end").text($(this).val());
            else
                $("#task_{{taskid}} .accessibility-custom-soft-end").text($(this).val());
        }
    });

    $('#accessibility_start_picker_{{taskid}}').on("change.datetimepicker", function () {
        let val = $("#accessibility_start_{{taskid}}").val();
        $("#task_{{taskid}} .accessibility-custom-start").text(val);
    });
    $('#accessibility_end_picker_{{taskid}}').on("change.datetimepicker", function () {
        let val = $("#accessibility_end_{{taskid}}").val();
        $("#task_{{taskid}} .accessibility-custom-end").text(val);
    });
    $('#accessibility_soft_end_picker_{{taskid}}').on("change.datetimepicker", function () {
        let val = $("#accessibility_soft_end_{{taskid}}").val();
        $("#task_{{taskid}} .accessibility-custom-soft-end").text(val);
    });
</script>

{% else %}
<script>
    $(".grouped-actions-accessibility input").change(function () {
        let action = $(this).attr("name");
        if(action == "accessibility_") {
            let value =  $(this).val();
            $(".grouped-actions-task:checked").each(function () {
                $(".accessibility #" + $(this).data("taskid") + "[value=" + value + "]").prop("checked", true).change();
            });
        }
        else {
            let value =  $(this).val();
            let id = $(this).attr("id");
            $(".grouped-actions-task:checked").each(function () {
                $(".accessibility #" + id + $(this).data("taskid")).val(value).change();
            });
        }
    });

    $('#accessibility_start_picker_').on("change.datetimepicker", function () {
        let value = $("#accessibility_start_").val();
        $(".grouped-actions-task:checked").each(function () {
            $(".accessibility #accessibility_start_" + $(this).data("taskid")).val(value).change();
        });
    });
    $('#accessibility_end_picker_').on("change.datetimepicker", function () {
        let value = $("#accessibility_end_").val();
        $(".grouped-actions-task:checked").each(function () {
            $(".accessibility #accessibility_end_" + $(this).data("taskid")).val(value).change();
        });
    });
    $('#accessibility_soft_end_picker_').on("change.datetimepicker", function () {
        let value = $("#accessibility_soft_end_").val();
        $(".grouped-actions-task:checked").each(function () {
            $(".accessibility #accessibility_soft_end_" + $(this).data("taskid")).val(value).change();
        });
    });
</script>
{% endif %}

{% endif %}
