{# This file is part of INGInious. See the LICENSE and the COPYRIGHTS files for #}
{# more information about the licensing of this file. #}

{% set no_stored_submissions = course.get_task_dispenser().get_no_stored_submissions(taskid) %}
{% if short %}
{{_("Submission storage")}} :
    <span class="submission_storage submission_storage-all_sub" {% if no_stored_submissions != 0 %} style="display: none;" {% endif %}>{{ _("All submissions") }}</span>
    <span class="submission_storage submission_storage-no_stored_submissions" {% if no_stored_submissions == 0 %} style="display: none;" {% endif %}>
        {{ _("Only the last {nbr_submissions} submissions").format(nbr_submissions="<span>" + str(no_stored_submissions) + "</span>") | safe }}
    </span>
{% else %}
<div class="mt-3">{{_("Submission storage")}}</div>
<div class="{%if not taskid %} grouped-actions-{% endif %}no_stored_submissions">
    <label>
        <input type="radio" value="store_all" class="no_stored_submissions" name="no_stored_submissions_{{taskid}}" {%if taskid %} id="{{taskid}}" {% endif %} {{ 'checked'|safe if no_stored_submissions == 0 }} />
        {{_("All submissions")}}
    </label><br/>
    <div class="row">
        <div>
            <label class="col-xs-12 col-lg-12">
                <input type="radio" value="store_not_all" class="no_stored_submissions" name="no_stored_submissions_{{taskid}}" {%if taskid %} id="{{taskid}}" {% endif %} {{ 'checked'|safe if no_stored_submissions > 0 }} />
                {{ _("Only the last {nbr_submissions} submissions").format(nbr_submissions='</label></div><div class="col-xs-offset-1 col-lg-offset-0 col-xs-11 col-lg-3"><input {%if taskid %} name="no_stored_submissions" {% endif %} class="form-control input-xs" id="no_stored_submissions_value_' + (taskid) + '" style="height:20px;padding: 0 10px;" value="' + (no_stored_submissions|string if no_stored_submissions > 0 else '') + '" placeholder="5" type="number"></div><div class="col-xs-offset-1 col-lg-offset-0 col-xs-11 col-lg-3"><label>') | safe }}
            </label>
        </div>
    </div>
</div>

{% if taskid %}
<script>
    $("#edit_{{taskid}} .no_stored_submissions input").change(function () {
        let action = $(this).attr("name");
        if(action == "no_stored_submissions_{{taskid}}") {
            $("#task_{{taskid}} .submission_storage").hide();
            if($(this).val() == "store_all")
                $("#task_{{taskid}} .submission_storage-all_sub").show();
            else
                $("#task_{{taskid}} .submission_storage-no_stored_submissions").show();
        }
        else
            $("#task_{{taskid}} .submission_storage-no_stored_submissions span").text($(this).val());
    });
</script>
{% else %}
<script>
    $(".grouped-actions-no_stored_submissions input").change(function () {
        let action = $(this).attr("name");
        if(action == "no_stored_submissions_") {
            let value =  $(this).val();
            $(".grouped-actions-task:checked").each(function () {
                $(".no_stored_submissions #" + $(this).data("taskid") + "[value=" + value + "]").prop("checked", true).change();
            });
        }
        else {
            let value =  $(this).val();
            $(".grouped-actions-task:checked").each(function () {
                $(".no_stored_submissions #no_stored_submissions_value_" + $(this).data("taskid")).val(value).change();
            });
        }
    });
</script>
{% endif %}
{% endif %}
