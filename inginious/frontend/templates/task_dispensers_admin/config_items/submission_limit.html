{# This file is part of INGInious. See the LICENSE and the COPYRIGHTS files for #}
{# more information about the licensing of this file. #}

{% set submission_limit = element.get_task_dispenser().get_submission_limit(taskid) %}

{% if short %}
{{ _("Submission limits") }} :

<span class="submission_limit submission_limit-none" {% if submission_limit != {'amount':-1, 'period':-1} %} style="display:none;" {% endif %}> {{ _("No limitation") }}</span>
<span class="submission_limit submission_limit-hard" {% if submission_limit["period"] != -1 or submission_limit["amount"] == -1 %} style="display:none;" {% endif %}>
    {{ _("Hard limit: {nbr_submissions} submission(s)").format(nbr_submissions='<span class="amount">' + str(submission_limit['amount']) + '</span>') | safe}}
</span>
<span class="submission_limit submission_limit-soft" {% if submission_limit["period"] == -1 %} style="display:none;" {% endif %}>
    {{ _("Soft limit: {nbr_submissions} submission(s) every {nbr_hours} hour(s)").format(nbr_submissions='<span class="amount">' + str(submission_limit['amount']) + '</span>', nbr_hours='<span class="period">' + str(submission_limit['period']) + '</span>') | safe}}
</span>

{% else %}
<div class="mt-3">{{ _("Submission limits") }}</div>
<div class="form-group {%if not taskid %} grouped-actions-{% endif %}submission_limits">
    <label>
        <input name="submission_limit_{{taskid}}" type="radio" value="none" class="submission_limit" {%if taskid %} id="{{taskid}}" {% endif %} {% if submission_limit == {'amount':-1, 'period':-1} %} checked="checked" {% endif %}/> {{ _("No limitation") }}
    </label><br/>
    <div class="row">
        <div class="col-xs-12 col-lg-3">
            <label>
                <input name="submission_limit_{{taskid}}" type="radio" value="hard" class="submission_limit" {%if taskid %} id="{{taskid}}" {% endif %}
                    {{ 'checked="checked"'|safe if submission_limit["period"] == -1 and submission_limit['amount'] >= 0 }} />
                {{ _("Hard limit: {nbr_submissions} submission(s)").format(nbr_submissions='</label></div><div class="col-xs-offset-1 col-lg-offset-0 col-xs-11 col-lg-2"><input class="form-control input-xs" id="submission_limit_hard_' + taskid + '" style="height:20px;padding: 0 10px;" value="' + (submission_limit['amount'] if submission_limit['period'] == -1 and submission_limit['amount'] >= 0 else '')|string + '" placeholder="5"  type="number"></div><div class="col-xs-offset-1 col-lg-offset-0 col-xs-11 col-lg-3"><label>') | safe }}
            </label>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12 col-lg-3">
            <label>
                <input name="submission_limit_{{taskid}}" type="radio" value="soft" class="submission_limit" {%if taskid %} id="{{taskid}}" {% endif %}
                    {{ 'checked="checked"'|safe if submission_limit['period'] >= 0 }} />
                {{ _("Soft limit: {nbr_submissions} submission(s) every {nbr_hours} hour(s)").format(nbr_submissions='</label></div><div class="col-xs-offset-1 col-lg-offset-0 col-xs-11 col-lg-2"><input class="form-control input-xs" id="submission_limit_soft_0_' + taskid + '" style="height:20px;padding: 0 10px;" value="' + (submission_limit['amount'] if submission_limit['amount'] >= 0 and submission_limit['period'] > 0 else '')|string + '" placeholder="5" type="number"></div><div class="col-xs-offset-1 col-lg-offset-0 col-xs-11 col-lg-3"><label>', nbr_hours='</label></div><div class="col-xs-offset-1 col-lg-offset-0 col-xs-11 col-lg-2"><input class="form-control input-xs" id="submission_limit_soft_1_' + taskid + '" style="height:20px;padding: 0 10px;" value="' + (submission_limit['period'] if submission_limit['period'] > 0 else '')|string + '" placeholder="5" type="number"></div><div class="col-xs-offset-1 col-lg-offset-0 col-xs-11 col-lg-1"><label>') | safe }}
            </label>
        </div>
    </div>
</div>

{% if taskid %}
<script>
    $("#edit_{{taskid}} .submission_limits input").change(function () {
        let action = $(this).attr("name");
        if(action == "submission_limit_{{taskid}}") {
            $("#task_{{taskid}} span.submission_limit").hide();
            if($(this).val() == "none")
                $("#task_{{taskid}} .submission_limit-none").show();
            else if($(this).val() == "hard")
                $("#task_{{taskid}} .submission_limit-hard").show();
            else
                $("#task_{{taskid}} .submission_limit-soft").show();
        }
        else {
            let id = $(this).attr("id");
            if (id == "submission_limit_hard_{{taskid}}")
                $("#task_{{taskid}} .submission_limit-hard span").text($(this).val());
            else if(id == "submission_limit_soft_0_{{taskid}}")
                $("#task_{{taskid}} .submission_limit-soft span.amount").text($(this).val());
            else
                $("#task_{{taskid}} .submission_limit-soft span.period").text($(this).val());
        }
    });
</script>
{% else %}
<script>
    $(".grouped-actions-submission_limits input").change(function () {
        let action = $(this).attr("name");
        if(action == "submission_limit_") {
            let value =  $(this).val();
            $(".grouped-actions-task:checked").each(function () {
                $("#edit-modals .submission_limits #" + $(this).data("taskid") + "[value=" + value + "]").prop("checked", true).change();
            });
        }
        else {
            let value =  $(this).val();
            let id = $(this).attr("id");
            $(".grouped-actions-task:checked").each(function () {
                $("#edit-modals .submission_limits #" + id + $(this).data("taskid")).val(value).change();
            });
        }
    });
</script>
{% endif %}
{% endif %}
